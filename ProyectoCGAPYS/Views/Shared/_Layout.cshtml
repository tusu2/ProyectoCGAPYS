@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@inject ProyectoCGAPYS.Datos.ApplicationDbContext DbContext

@{
    // --- VARIABLES UNIFICADAS EN UN SOLO BLOQUE ---

    // 1. Obtenemos el controlador y la acción actual
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();

    // 2. Obtenemos las notificaciones sin leer
    var notificacionesSinLeer = 0;
    if (ViewBag.ConteoNotificacionesBadge != null && ViewBag.ConteoNotificacionesBadge > 0)
    {
        notificacionesSinLeer = ViewBag.ConteoNotificacionesBadge;
    }
    // Si no, hacemos la consulta normal a la base de datos (para las otras páginas).
    else if (SignInManager.IsSignedIn(User))
    {
        var userId = UserManager.GetUserId(User);
        if (userId != null)
        {
            notificacionesSinLeer = DbContext.Notificaciones.Count(n => n.UsuarioId == userId && !n.Leida);
        }
    }
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - ProyectoCGAPYS</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  
    @Html.Partial("_Splash")
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: #0B2D48;">
            <div class="container-fluid">
                <a class="navbar-brand" asp-controller="Dashboard" asp-action="Index">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                         width="60px" height="60px" viewBox="400 400 800 800"
                     preserveAspectRatio="xMidYMid meet" style="fill: #ffffff; margin-right: 10px;">
                    <g transform="translate(0.000000,1600.000000) scale(0.100000,-0.100000)">
                        <path d="M7690 11779 c-926 -81 -1767 -480 -2409 -1144 -486 -504 -808 -1097 -965 -1779 -115 -496 -125 -1044 -30 -1551 188 -1000 775 -1880 1632 -2449 508 -337 1053 -532 1697 -607 145 -17 625 -17 770 0 546 64 1005 208 1452 457 543 302 1033 765 1359 1284 307 487 489 1004 561 1590 21 179 24 647 5 815 -88 758 -353 1405 -808 1975 -129 161 -407 443 -554 561 -584 472 -1221 743 -1963 835 -146 18 -598 26 -747 13z m715 -214 c598 -76 1077 -251 1567 -572 366 -240 734 -603 990 -978 679 -995 806 -2280 336 -3395 -330 -782 -939 -1430 -1701 -1811 -382 -192 -731 -295 -1217 -361 -127 -17 -633 -17 -760 0 -496 67 -844 172 -1239 372 -386 196 -702 436 -1008 765 -609 653 -953 1527 -953 2420 0 715 219 1428 618 2010 231 337 549 665 871 898 286 207 654 393 986 500 286 92 592 150 895 171 113 8 499 -4 615 -19z" />
                        <path d="M7966 11169 c-3 -19 -8 -111 -11 -205 l-6 -171 47 -7 c199 -27 303 46 304 213 0 51 -5 73 -25 108 -38 64 -87 86 -207 91 l-97 4 -5 -33z m196 -97 c11 -10 22 -37 25 -59 10 -79 -48 -145 -113 -129 -21 6 -25 11 -20 29 3 12 6 60 6 106 l0 84 41 -6 c23 -3 51 -14 61 -25z" />
                        <path d="M7473 11153 c-18 -2 -33 -6 -33 -8 0 -5 -69 -376 -74 -398 -4 -16 2 -18 42 -15 44 3 48 5 58 38 12 36 21 41 101 53 39 7 43 5 55 -20 11 -23 20 -28 50 -27 73 2 74 5 21 101 -26 49 -70 131 -98 183 -54 99 -56 102 -122 93z m85 -239 c-2 -1 -17 -4 -33 -6 -29 -3 -30 -1 -27 32 6 72 12 76 38 25 14 -26 23 -49 22 -51z" />
                        <path d="M8963 10949 c-32 -40 -91 -111 -130 -160 -40 -49 -73 -90 -73 -92 0 -2 18 -12 40 -22 l40 -18 28 26 28 27 62 -21 c60 -20 62 -22 62 -55 0 -36 12 -47 68 -59 l32 -7 0 212 0 211 -35 15 c-19 7 -41 14 -49 14 -8 0 -41 -32 -73 -71z m64 -129 c-1 -27 -6 -50 -12 -50 -20 0 -55 12 -55 19 0 7 59 81 65 81 2 0 3 -22 2 -50z" />
                        <path d="M6900 11003 c-14 -3 -58 -18 -98 -35 -64 -27 -72 -33 -66 -52 3 -11 34 -95 68 -186 71 -189 62 -182 180 -138 74 27 131 81 146 140 15 54 0 137 -35 190 -38 58 -126 94 -195 81z m64 -109 c24 -9 56 -69 58 -107 2 -45 -22 -82 -60 -95 l-30 -10 -36 96 c-34 90 -36 97 -20 109 19 14 62 17 88 7z" />
                        <path d="M9426 10704 c-84 -140 -97 -185 -70 -240 56 -112 202 -139 280 -52 34 38 145 230 141 242 -5 13 -74 53 -80 46 -2 -3 -34 -56 -72 -118 -73 -122 -95 -138 -144 -111 -46 26 -40 59 33 181 36 60 66 113 66 118 0 9 -63 50 -76 50 -5 -1 -40 -53 -78 -116z" />
                        <path d="M6415 10775 c-59 -31 -59 -32 4 -140 32 -55 77 -133 100 -172 l42 -73 39 20 c21 11 41 23 43 27 3 6 -134 253 -190 341 -6 10 -14 9 -38 -3z" />
                        <path d="M6068 10536 c-75 -27 -138 -100 -138 -161 0 -59 63 -125 119 -125 11 0 50 11 87 25 36 14 70 22 75 19 30 -18 -27 -75 -91 -91 -21 -6 -36 -16 -38 -27 -6 -27 18 -76 37 -76 56 2 159 68 186 121 27 52 17 97 -33 152 -32 34 -88 36 -162 7 -60 -24 -80 -25 -80 -5 0 22 40 54 82 67 42 12 49 34 26 83 -13 28 -18 29 -70 11z" />
                        <path d="M7805 10494 c-632 -67 -1128 -296 -1553 -717 -403 -398 -636 -867 -723 -1452 -18 -116 -18 -521 -1 -630 75 -473 221 -830 483 -1180 223 -298 539 -564 867 -729 567 -286 1234 -344 1840 -160 220 67 398 148 596 271 883 548 1330 1584 1126 2603 -95 473 -315 890 -655 1239 -392 403 -887 657 -1435 736 -110 16 -458 28 -545 19z m515 -170 c251 -36 486 -109 712 -221 627 -311 1083 -885 1242 -1563 41 -176 59 -330 59 -525 1 -373 -73 -693 -238 -1030 -227 -465 -598 -837 -1060 -1065 -220 -108 -411 -171 -655 -215 -125 -23 -499 -32 -641 -15 -792 90 -1484 579 -1834 1295 -164 335 -238 655 -238 1025 1 375 73 688 238 1027 208 427 547 785 960 1014 443 246 964 343 1455 273z" />
                        <path d="M6827 9391 l-28 -6 1 -447 c0 -411 2 -452 20 -524 35 -138 115 -240 231 -298 94 -47 161 -59 299 -54 95 4 126 10 180 32 120 49 218 147 264 266 41 103 46 174 46 610 l0 417 -71 7 c-39 4 -99 4 -134 1 l-64 -7 -3 -432 -3 -431 -30 -60 c-38 -74 -84 -112 -158 -127 -113 -24 -213 18 -267 113 l-25 44 -5 445 -5 445 -40 7 c-48 8 -169 8 -208 -1z" />
                        <path d="M8529 9393 c-16 -4 -46 -87 -414 -1131 l-54 -153 26 -10 c14 -5 75 -8 136 -7 l110 3 28 80 c16 44 36 101 45 128 l16 47 226 0 227 0 44 -129 45 -129 56 -7 c51 -6 207 8 218 20 5 4 -45 149 -319 932 -120 344 -123 351 -152 357 -33 7 -213 6 -238 -1z m191 -587 l68 -206 -139 0 c-76 0 -139 1 -139 3 0 2 24 73 54 158 29 85 59 178 66 207 7 29 14 51 17 48 3 -2 36 -97 73 -210z" />
                        <path d="M8580 7960 c-239 -64 -399 -226 -466 -471 -27 -97 -25 -299 4 -402 52 -184 146 -305 303 -390 102 -56 172 -71 339 -72 170 0 249 16 355 74 81 43 89 62 57 135 -23 50 -94 132 -123 141 -11 4 -30 -2 -47 -14 -78 -55 -243 -78 -346 -47 -86 26 -174 112 -210 204 -43 111 -39 274 10 382 31 70 102 141 169 171 102 46 252 36 351 -23 25 -15 38 -17 52 -9 31 16 87 84 109 131 40 85 40 86 -20 124 -95 61 -164 79 -322 83 -117 3 -152 0 -215 -17z" />
                        <path d="M6778 7753 l-28 -4 0 -328 0 -328 38 -7 c66 -11 236 -6 288 8 65 17 136 66 174 118 47 64 62 126 58 232 -3 79 -7 101 -33 151 -35 69 -101 124 -177 149 -48 15 -242 21 -320 9z m305 -166 c65 -50 90 -132 67 -226 -23 -95 -85 -141 -190 -141 l-60 0 0 201 0 201 73 -4 c62 -3 80 -8 110 -31z" />
                        <path d="M7430 7420 l0 -330 220 0 220 0 0 65 0 65 -145 0 -145 0 0 70 0 70 125 0 125 0 0 65 0 65 -125 0 -125 0 0 65 0 65 140 0 140 0 0 65 0 65 -215 0 -215 0 0 -330z" />
                        <path d="M6750 6900 l0 -60 560 0 560 0 0 60 0 60 -560 0 -560 0 0 -60z" />
                        <path d="M9985 10436 l-26 -35 37 -34 38 -35 -101 -112 c-56 -62 -99 -118 -96 -124 2 -6 18 -22 35 -35 l31 -25 35 40 c20 21 67 72 104 113 l68 75 34 -33 c39 -38 54 -36 85 7 l21 29 -112 102 c-61 55 -115 101 -119 101 -5 0 -20 -15 -34 -34z" />
                        <path d="M5598 10103 c-40 -32 -118 -130 -118 -149 0 -12 287 -264 301 -264 4 0 19 17 35 37 l28 37 -47 41 c-76 66 -62 85 46 60 l72 -17 33 38 c17 20 32 41 32 45 0 7 -21 12 -142 35 -24 5 -28 10 -28 42 0 29 -8 43 -45 79 -39 37 -51 43 -89 43 -31 0 -52 -7 -78 -27z m102 -93 c26 -26 25 -43 -2 -74 l-23 -25 -39 33 -39 34 26 26 c31 31 50 33 77 6z" />
                        <path d="M10557 10003 c-17 -16 -3 -36 55 -79 l63 -46 22 27 c39 45 31 59 -50 83 -82 25 -81 25 -90 15z" />
                        <path d="M10345 9988 c-16 -6 -47 -23 -67 -38 -122 -88 -130 -223 -20 -322 48 -44 75 -52 142 -46 63 6 135 50 174 105 105 151 -55 362 -229 301z m126 -127 c34 -34 37 -64 9 -108 -39 -64 -121 -83 -167 -37 -21 21 -25 32 -20 66 6 45 25 69 70 92 47 23 75 20 108 -13z" />
                        <path d="M5236 9590 c-31 -55 -57 -106 -59 -112 -1 -6 75 -55 168 -108 l170 -98 62 107 c35 58 61 110 60 116 -5 15 -65 47 -76 40 -6 -3 -24 -33 -42 -65 -17 -33 -35 -60 -38 -60 -4 0 -16 7 -27 15 -19 14 -18 16 14 74 l32 60 -39 21 c-22 11 -42 20 -43 20 -2 0 -17 -25 -33 -55 -32 -58 -35 -61 -65 -45 -18 10 -17 13 15 69 19 33 35 64 35 69 0 9 -60 52 -73 52 -3 0 -30 -45 -61 -100z" />
                        <path d="M10650 9394 c-91 -42 -169 -80 -174 -85 -9 -8 20 -89 32 -89 2 0 44 18 93 40 49 22 91 40 95 40 3 0 -27 -47 -66 -104 l-71 -105 21 -40 c11 -23 25 -41 30 -41 9 0 88 34 298 131 34 15 62 31 62 34 0 3 -9 23 -20 45 l-20 39 -37 -16 c-21 -8 -64 -29 -97 -45 -32 -16 -60 -27 -62 -25 -3 3 27 49 66 104 38 55 70 106 70 113 0 22 -32 80 -44 79 -6 0 -85 -34 -176 -75z" />
                        <path d="M5024 9153 c-13 -34 -15 -48 -6 -51 16 -5 193 -112 219 -132 12 -10 21 -19 18 -21 -3 -3 -180 6 -274 14 -22 2 -27 -4 -39 -46 -7 -27 -11 -51 -8 -55 11 -11 230 -20 321 -13 83 6 91 8 102 31 32 68 30 73 -52 143 -78 67 -236 177 -254 177 -5 0 -17 -21 -27 -47z" />
                        <path d="M10872 8830 c-86 -18 -141 -69 -163 -151 -10 -36 -9 -54 4 -100 27 -92 104 -149 200 -149 48 0 127 33 161 68 45 44 60 90 53 160 -13 126 -122 199 -255 172z m125 -126 c13 -8 25 -29 29 -50 8 -46 -17 -82 -71 -101 -76 -27 -145 10 -145 76 1 47 19 70 72 86 46 15 80 12 115 -11z" />
                        <path d="M4855 8534 c-3 -25 -5 -47 -3 -49 2 -2 90 -18 197 -35 160 -26 195 -30 202 -19 9 15 13 89 4 89 -2 0 -86 14 -187 30 -100 17 -187 30 -194 30 -6 0 -15 -21 -19 -46z" />
                        <path d="M4908 8163 l-98 -4 0 -37 c0 -61 5 -64 119 -60 55 2 101 0 101 -3 0 -3 -47 -35 -105 -70 l-106 -64 3 -50 3 -50 43 0 c355 4 350 4 357 25 4 11 4 34 0 50 l-7 30 -106 1 c-87 0 -103 2 -88 12 10 7 59 38 108 70 l89 57 -3 48 -3 47 -105 1 c-58 0 -149 -1 -202 -3z" />
                        <path d="M10787 8164 c-4 -4 -7 -25 -7 -46 l0 -38 107 0 c62 0 103 -4 98 -9 -6 -5 -41 -19 -80 -31 -89 -29 -97 -35 -93 -78 3 -34 5 -35 93 -68 l90 -33 -106 0 -107 -1 -5 -32 c-2 -18 -2 -38 0 -44 4 -10 200 -24 346 -24 l58 0 -3 56 -3 56 -112 42 c-61 23 -114 44 -117 47 -4 3 49 26 116 51 l123 46 0 53 0 54 -196 3 c-107 1 -198 -1 -202 -4z" />
                        <path d="M4966 7534 c-61 -13 -111 -26 -114 -28 -5 -5 8 -69 17 -84 5 -9 37 -5 124 13 64 14 128 25 140 25 35 0 59 -32 55 -71 -4 -43 -21 -51 -167 -81 -67 -13 -116 -28 -119 -36 -2 -8 0 -31 7 -51 l11 -38 136 29 c76 16 150 36 166 46 67 39 91 136 54 215 -42 87 -123 103 -310 61z" />
                        <path d="M10741 7513 c-6 -29 -6 -49 -1 -51 6 -2 19 -11 30 -20 19 -16 19 -19 4 -80 -14 -53 -20 -63 -43 -68 -14 -3 -31 -7 -37 -9 -11 -3 -29 -83 -21 -91 8 -9 403 39 414 50 7 6 15 29 19 52 l6 40 -176 112 c-97 62 -178 112 -180 112 -3 0 -9 -21 -15 -47z m201 -195 c-9 -3 -33 -7 -54 -7 -32 -1 -36 1 -31 22 10 48 11 48 58 20 36 -23 42 -29 27 -35z" />
                        <path d="M5212 6677 l-72 -72 73 -73 73 -72 72 67 c40 36 72 72 72 78 0 10 -132 145 -142 145 -2 0 -36 -33 -76 -73z" />
                        <path d="M10632 6677 l-72 -72 75 -75 75 -74 75 74 75 75 -72 72 c-40 40 -75 73 -78 73 -3 0 -38 -33 -78 -73z" />
                        <path d="M5708 6239 c-93 -55 -168 -107 -168 -114 0 -16 46 -99 78 -142 48 -65 151 -91 229 -58 90 38 143 108 143 188 0 48 -41 139 -88 195 l-27 32 -167 -101z m160 -64 c15 -32 15 -70 2 -96 -13 -24 -81 -59 -115 -59 -28 0 -89 52 -83 70 4 12 157 108 174 109 6 1 16 -10 22 -24z" />
                        <path d="M10034 6197 c-12 -17 -24 -37 -28 -44 -8 -15 244 -328 264 -328 8 0 23 15 33 33 20 33 20 33 -2 63 l-22 29 33 55 c32 53 34 55 73 53 37 -3 41 0 62 38 l23 42 -47 11 c-27 5 -119 26 -206 46 -87 19 -159 35 -160 35 -1 0 -12 -15 -23 -33z m170 -99 c22 -6 42 -12 44 -14 5 -3 -21 -54 -29 -54 -4 0 -22 18 -39 40 -35 44 -35 45 24 28z" />
                        <path d="M6040 5734 l-141 -138 90 -90 89 -89 27 17 c44 29 42 43 -16 102 l-53 54 22 22 22 22 50 -49 50 -49 32 32 32 32 -42 43 c-46 47 -50 58 -26 78 15 12 22 7 64 -39 25 -28 51 -52 56 -52 6 0 23 13 39 30 l28 30 -79 87 c-44 48 -85 88 -91 90 -7 3 -75 -58 -153 -133z" />
                        <path d="M9676 5740 c-14 -17 -26 -35 -26 -38 0 -4 64 -67 141 -141 l141 -133 75 73 c101 100 102 104 64 143 l-32 31 -51 -53 c-58 -61 -38 -69 -176 63 -46 44 -89 81 -96 83 -8 2 -25 -11 -40 -28z" />
                        <path d="M9410 5512 l-33 -28 117 -157 c65 -86 123 -157 130 -157 6 0 26 12 44 28 l31 27 -75 100 c-42 55 -94 126 -117 157 -23 32 -47 58 -52 58 -6 0 -26 -13 -45 -28z" />
                        <path d="M9128 5332 c-16 -9 -28 -20 -28 -24 0 -4 25 -60 56 -125 61 -129 63 -156 13 -180 -49 -24 -66 -9 -131 121 -33 66 -62 123 -64 125 -3 3 -25 -5 -49 -17 l-45 -22 64 -128 c77 -154 113 -192 182 -192 59 0 103 19 141 63 34 39 49 90 39 134 -14 57 -119 263 -135 263 -9 0 -28 -8 -43 -18z" />
                        <path d="M6763 5308 c-100 -54 -152 -199 -107 -294 20 -42 83 -88 142 -104 60 -16 82 -7 82 35 0 53 -8 65 -47 65 -71 0 -103 70 -67 146 33 69 105 86 156 37 l29 -28 36 20 c47 26 49 36 18 73 -58 69 -165 91 -242 50z" />
                        <path d="M7273 5121 c-84 -39 -140 -164 -115 -258 26 -94 95 -146 197 -147 51 -1 69 4 102 26 101 67 131 223 61 321 -27 37 -111 77 -163 77 -22 0 -59 -9 -82 -19z m126 -96 c49 -25 58 -95 22 -163 -20 -37 -71 -53 -116 -36 -19 8 -45 55 -45 83 0 38 32 102 59 116 33 18 46 18 80 0z" />
                        <path d="M8593 5123 c-27 -5 -27 -9 -8 -88 7 -33 11 -63 7 -66 -7 -6 -93 -29 -110 -29 -5 0 -15 28 -22 63 -7 34 -16 67 -19 73 -7 14 -97 -6 -95 -21 4 -35 79 -372 84 -378 4 -4 27 -3 52 3 l44 11 -13 62 c-19 94 -20 91 45 103 32 6 60 7 63 2 3 -4 11 -38 18 -73 7 -36 18 -65 25 -65 6 0 28 5 49 11 28 7 37 15 34 27 -3 9 -22 97 -43 195 -42 195 -35 185 -111 170z" />
                        <path d="M7901 5032 c-12 -22 -141 -366 -141 -375 0 -4 22 -7 49 -7 45 0 50 2 60 30 10 29 11 30 79 30 l69 0 9 -32 c9 -31 13 -33 57 -36 40 -3 47 0 46 15 0 10 -29 101 -62 203 l-62 185 -47 3 c-37 2 -49 -1 -57 -16z m63 -159 c3 -16 8 -38 12 -50 6 -21 3 -23 -29 -23 l-35 0 16 50 c18 57 27 62 36 23z" />
                    </g>
                </svg>
                </a>
      
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "Presupuesto" ? "active" : "")" asp-controller="Presupuesto" asp-action="Index">
                                <i class="bi bi-cash-coin"></i>
                                <span>Control Presupuestal</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "RecursosHumanos" ? "active" : "")" asp-controller="RecursosHumanos" asp-action="Index">
                                <i class="bi bi-people-fill"></i>
                                <span>Recursos Humano</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "Dashboard" ? "active" : "")" asp-controller="Dashboard" asp-action="Index">
                                <i class="bi bi-kanban-fill"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "PanelDeFases" ? "active" : "")" asp-controller="PanelDeFases" asp-action="Index">
                                <i class="bi bi-grid-1x2-fill"></i>
                                <span>Panel de fases</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "Registro" ? "active" : "")" asp-controller="Registro" asp-action="Crear">
                                <i class="bi bi-plus-square-fill"></i>
                                <span>Registro</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "Proyecto" ? "active" : "")" asp-controller="Proyecto" asp-action="Index">
                                <i class="bi bi-map-fill"></i>
                                <span>Proyectos</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "Anteproyecto" ? "active" : "")" asp-controller="Anteproyecto" asp-action="Index">
                                <i class="bi bi-easel-fill"></i>
                                <span>Anteproyecto</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "ElaboracionPresupuesto" ? "active" : "")" asp-controller="ElaboracionPresupuesto" asp-action="Index">
                                <i class="bi bi-calculator-fill"></i>
                                <span>Elaboracion de presupuesto</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "Licitaciones" ? "active" : "")" asp-controller="Licitaciones" asp-action="Index">
                                <i class="bi bi-briefcase-fill"></i>
                                <span>Licitaciones</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentController == "GestionEstimaciones" ? "active" : "")" asp-controller="GestionEstimaciones" asp-action="Index">
                                <i class="bi bi-plus-square-fill"></i>
                                <span>Estimaciones</span>
                            </a>
                        </li>
                        @if (SignInManager.IsSignedIn(User))
                        {
                            <li class="nav-item">
                                <a class="nav-link" asp-area="Identity" asp-page="/Account/Manage/Index" title="Manage">
                                    <i class="bi bi-person-circle"></i>
                                    <span>Hola @User.Identity?.Name!</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <form class="form-inline" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })">
                                    <button type="submit" class="nav-link btn btn-link">
                                        <i class="bi bi-box-arrow-right"></i>
                                        <span>Logout</span>
                                    </button>
                                </form>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item">
                                <a class="nav-link" asp-area="Identity" asp-page="/Account/Register">
                                    <i class="bi bi-person-plus-fill"></i>
                                    <span>Register</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" asp-area="Identity" asp-page="/Account/Login">
                                    <i class="bi bi-box-arrow-in-right"></i>
                                    <span>Login</span>
                                </a>
                            </li>
                        }

                    </ul>
                    
                </div>
            </div>
        </nav>
    </header>

    <main role="main" class="pb-3">
        <div class="container-fluid">
            @RenderBody()
        </div>
    </main>
    <nav class="mobile-nav">
        <a asp-controller="Dashboard" asp-action="Index" class="mobile-nav-link @(currentController == "Dashboard" ? "active" : "")">
            <i class="bi bi-grid-1x2-fill"></i>
            <span>Dashboard</span>
        </a>
        <a asp-controller="Proyecto" asp-action="Index" class="mobile-nav-link @(currentController == "Proyecto" ? "active" : "")">
            <i class="bi bi-map-fill"></i>
            <span>Proyectos</span>
        </a>
        <a asp-controller="Registro" asp-action="Crear" class="mobile-nav-link @(currentController == "Registro" ? "active" : "")">
            <i class="bi bi-plus-square-fill"></i>
            <span>Registro</span>
        </a>
        <button type="button" id="more-modules-btn" class="mobile-nav-link">
            <i class="bi bi-grid-3x3-gap-fill"></i>
            <span>Más</span>
        </button>
    </nav>
    <div id="mobile-modules-sheet">
        <div class="sheet-header">
            <h4>Todos los Módulos</h4>
            <button type="button" id="close-sheet-btn">&times;</button>
        </div>
        <div class="sheet-content">
            <a href="#" class="sheet-link">
                <i class="bi bi-book-fill"></i>
                <span>Catálogo de Conceptos</span>
            </a>
            <a href="#" class="sheet-link">
                <i class="bi bi-file-earmark-text-fill"></i>
                <span>Reportes Financieros</span>
            </a>
            <a href="#" class="sheet-link">
                <i class="bi bi-camera-fill"></i>
                <span>Reporte Fotográfico</span>
            </a>
            <a href="#" class="sheet-link">
                <i class="bi bi-people-fill"></i>
                <span>Gestionar Usuarios</span>
            </a>
            <a href="#" class="sheet-link">
                <i class="bi bi-building-fill"></i>
                <span>Gestionar Campus</span>
            </a>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
            <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        window.addEventListener('load', function () {
            const splashScreen = document.getElementById('splash-screen');

            // Tiempo de espera: debe ser un poco MÁS LARGO que tu animación
            // Tu animación más larga termina de rellenarse en 3.7s (3.2s + 0.5s)
            // Le daremos 4 segundos (4000 milisegundos) para estar seguros.
            setTimeout(function () {
                // 1. Agregamos la clase para iniciar el desvanecimiento (fade-out)
                splashScreen.classList.add('fade-out');

                // 2. Después de que termine la transición de desvanecimiento (0.5s),
                // lo ocultamos completamente para que no bloquee los clics.
                setTimeout(function () {
                    splashScreen.style.display = 'none';
                }, 500); // 500ms coincide con la transición en el CSS

            }, 4000);
        });
        document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.querySelector('.sidebar');
            const toggleButton = document.getElementById('sidebar-toggle');
            const mainContent = document.querySelector('.contenido-principal');
           //const toggleIcon = toggleButton.querySelector('i'); // Seleccionamos la etiqueta <i>
            const openBtn = document.getElementById('more-modules-btn');
            const closeBtn = document.getElementById('close-sheet-btn');
            const sheet = document.getElementById('mobile-modules-sheet');

            if (openBtn && sheet) {
                let overlay = document.createElement('div');
                overlay.className = 'sheet-overlay';
                document.body.appendChild(overlay);

                const openSheet = () => {
                    sheet.classList.add('is-open');
                    overlay.classList.add('is-open');
                };

                const closeSheet = () => {
                    sheet.classList.remove('is-open');
                    overlay.classList.remove('is-open');
                };

                openBtn.addEventListener('click', openSheet);
                closeBtn.addEventListener('click', closeSheet);
                overlay.addEventListener('click', closeSheet);
            }
            // Función para actualizar el icono
            function updateIcon() {
                if (sidebar.classList.contains('collapsed')) {
                    toggleIcon.className = 'bi bi-list'; // Ícono de menú (hamburguesa)
                    toggleButton.title = 'Expandir menú';
                } else {
                    toggleIcon.className = 'bi bi-arrow-left'; // Ícono de flecha
                    toggleButton.title = 'Contraer menú';
                }
            }
           

            // 2. Comprobamos SI EXISTE ese botón en la página actual.
            if (toggleButton) {

                // 3. SOLO SI EXISTE, le agregamos el 'escuchador' de eventos de clic.
                toggleButton.addEventListener('click', function () {
                    // El código de adentro, que ya funciona, se queda igual.
                    sidebar.classList.toggle('collapsed');
                    mainContent.classList.toggle('collapsed');
                    updateIcon();
                });

       
                updateIcon();
            }
        });
    
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>